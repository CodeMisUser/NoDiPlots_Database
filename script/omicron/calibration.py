__all__ = ['get_phase', 'get_magnitude']

import io
from functools import partial

import numpy as np
import pandas as pd


phase_str = """frequency,phase
0.0010352168093366492, 89.66858457997698
0.002068509977389941, 89.29574223245109
0.00306205174934455, 88.9228998849252
0.005327378699560289, 88.17721518987341
0.011407815934794022, 86.12658227848101
0.015757770854650646, 84.4487917146145
0.02102595550984022, 82.58457997698504
0.025581923397742626, 81.09321058688147
0.03335594719636605, 78.11047180667434
0.0401180940602895, 75.87341772151899
0.04881100450504846, 73.26352128883774
0.05736723036807907, 70.28078250863061
0.06979773604724074, 66.73878020713464
0.07924213327715023, 63.56962025316456
0.09100838751722226, 60.586881472957415
0.10452175195128408, 57.23130034522439
0.11730352547260187, 53.875719217491365
0.1331759756948015, 50.333716915995396
0.1529505870522993, 46.41887226697354
0.18716895709085432, 40.63981588032221
0.21997835914386038, 36.16570771001151
0.24545909190189083, 32.99654775604143
0.28517721441283966, 29.45454545454546
0.3313221889241421, 25.726121979286546
0.4173104788629348, 21.065592635212894
0.5048141549706182, 17.710011507479862
0.610666024378459, 14.727272727272734
0.7429869929070574, 12.117376294591494
0.957658915029033, 9.507479861910241
1.3853033523157154, 6.71116225546605
2.1976697063382553, 4.287686996547762
2.800152139938469, 3.355581127733032
3.8235208744337763, 2.4234752589183017
5.281481235469188, 1.6777905638665231
7.128975790380784, 1.118527042577682
11.573522312012695, 0.7456846950517928
19.22758958196343, 0.3728423475259035
37.112467730724084, 0
58.2005288688351, -0.18642117376295175
168.22373265017146, -0.7456846950517786
515.1097748427273, -2.6098964326812393
949.4083065885786, -5.033371691599527
"""


magnitude_str = """frequency,magnitude
0.0011684686900396305, 0.0001628175519630473
0.0010056803407339741, 0.00013163972286374392
0.001986847709622945, 0.0003187066974595851
0.002744683709545704, 0.0004434180138568125
0.004612912114126294, 0.0008799076212471155
0.00629893636874721, 0.0011293302540415703
0.008118239815986658, 0.0015658198614318664
0.010956794198548718, 0.0021270207852193967
0.013798070769620087, 0.002750577367205541
0.016593051421719858, 0.0032494226327944575
0.02089367416529787, 0.00412240184757506
0.024550645600236325, 0.004808314087759814
0.027547617479228504, 0.005369515011547345
0.03236576214234489, 0.006304849884526557
0.03846394798294849, 0.007489607390300232
0.047859462620932484, 0.009235565819861433
0.05494267760600983, 0.01035796766743649
0.06092762222326296, 0.011480369515011551
0.06756631206004093, 0.012540415704387988
0.0744991830616252, 0.013538106235565818
0.08214123531126473, 0.014598152424942265
0.09266977969009327, 0.01596997690531178
0.10216213694478812, 0.017341801385681296
0.11394033460276619, 0.01858891454965358
0.12418327308940559, 0.01971131639722864
0.13379742617941132, 0.020771362586605082
0.15009047187240623, 0.021956120092378753
0.1693284853739054, 0.02332794457274827
0.18349850166140136, 0.0243256351039261
0.20348712285070217, 0.025448036951501156
0.22696515244095658, 0.0265080831408776
0.2590705646938163, 0.02750577367205543
0.30261499758082594, 0.028565819861431873
0.38540920235720244, 0.029812933025404158
0.4528664830935705, 0.030498845265588916
0.5869820156494607, 0.031184757505773673
0.7968274104291799, 0.03168360277136259
1.2141098683197857, 0.03202655889145497
2.0883930183363395, 0.03221362586605081
3.551216071491733, 0.032275981524249424
12.640078044562877, 0.032307159353348734
41.98102263910653, 0.032307159353348734
167.70915586290832, 0.032307159353348734
452.5225808728866, 0.032275981524249424
769.5348149352939, 0.03221362586605081
"""


def load_from_string(s):
    sio = io.StringIO(s)
    return pd.read_csv(sio, index_col='frequency')


phase = load_from_string(phase_str) / 360
magnitude = load_from_string(magnitude_str)
magnitude.magnitude = magnitude.magnitude / np.interp(50,
                                                      magnitude.index,
                                                      magnitude.magnitude)

def get_calibration(freq, df, series):
    return np.interp(np.log(freq), np.log(df.index), df[series])

get_phase = partial(get_calibration, df=phase, series='phase')
get_magnitude = partial(get_calibration, df=magnitude, series='magnitude')


if __name__ == '__main__':
    # Light testing of the module
    print(get_phase(0.01))
    print(get_magnitude(0.01))

